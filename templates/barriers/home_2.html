{% extends 'base.html' %}
{% load static %}
{% load render_bundle from webpack_loader %}
{% block page_title %}{{ block.super }} - Homepage{% endblock %}
{% block head %}
    {% block body_script %}
         <script src="https://unpkg.com/htmx.org@2.0.4"
                integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
                crossorigin="anonymous"
                nonce="{{request.csp_nonce}}">/></script> 
    {% endblock body_script %}
{% endblock head %}
{% block masthead %}
    <div class="ma-masthead">
        <div class="govuk-grid-row govuk-width-container ma-container-full govuk-!-padding-top-5 govuk-!-margin-left-0">
            <div class="govuk-grid-column-two-thirds govuk-!-padding-left-0">
                <h1 class="govuk-heading-xl">
                    <span class="govuk-caption-m">Market access barriers</span>
                    Dashboard
                </h1>
                <div class="govuk-form-group">
                    <!--htmx test start -->
                    <form action="{% url 'barriers:search' %}" method="GET">
                        {% csrf_token %}
                        <label class="govuk-visually-hidden" for="search_term">Search term</label>
                        <input class=" govuk-input govuk-!-width-two-thirds"
                               type="search"
                               id="search_term"
                               name="search_term_text"
                               placeholder="Begin Typing To Search Users..."
                               hx-post="{% url 'barriers:search_typeahead' %}"
                               hx-trigger="input changed delay:300ms, keyup[key=='Enter']"
                               hx-target="#search_typeahead_results"
                               hx-indicator=".htmx-indicator"
                               autocomplete="off">
                        <button id="search_submit_button"
                                type="submit"
                                class="govuk-button"
                                data-module="govuk-button">Search</button>
                        <span class="htmx-indicator">Searching...</span>
                        <div id="search_typeahead_results" class="typeahead-results"></div>
                    </form>
                    <!-- end htmx test-->
                    {% comment %} <form action="{% url 'barriers:search' %}" method="GET">
                        <label class="govuk-visually-hidden" for="search_term">Search term</label>
                        <input class="govuk-input govuk-!-width-two-thirds" id="search_term" name="search_term_text" type="text" placeholder="Search for barrier by name or with key terms." <input type="hidden" name="ordering" value="relevance" />
                            <button id="search_submit_button" type="submit" class="govuk-button" data-module="govuk-button">Search</button>
                    </form> {% endcomment %}
                </div>
            </div>
            <div class="govuk-grid-column-one-third">
                <!-- Dashboard version Toggle  -->
                <div class="dashboard-banner govuk-!-margin-bottom-0">
                    <div class="govuk-notification-banner"
                         role="region"
                         aria-labelledby="govuk-notification-banner-title"
                         data-module="govuk-notification-banner">
                        <div class="govuk-notification-banner__content">
                            <p class="govuk-heading-s">
                                Return to old dashboard
                                <label for="dashboard_switch" class="switch">
                                    <input type="checkbox"
                                           id="dashboard_switch"
                                           aria-label="Return to old dashboard"
                                           onclick='window.location.assign("/?default=dashboard")'
                                           checked>
                                    <span class="slider round"></span>
                                </label>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- end dashboard toggle -->
                <div class="govuk-!-text-align-right">
                    <div id="get_help" class="dash-card govuk-!-text-align-left">
                        <span class="dash-card__heading">Get help</span>
                        <span class="dash-button__text dashboard_button__text">
                            Read the <a href="https://data-services-help.trade.gov.uk/market-access/the-market-access-playbook/"
    target="_blank">market access playbook</a> for help resolving your barriers.
                        </span>
                        <span class="dash-button__text dashboard_button__text">You can also find out:</span>
                        <ul class="dash-card__text dashboard_button__text">
                            <li>
                                <a href="https://data-services-help.trade.gov.uk/market-access/how-guides/"
                                   target="_blank">how to use DMAS</a>
                            </li>
                            <li>
                                <a href="https://data-services-help.trade.gov.uk/market-access/updates/"
                                   target="_blank">what's new on DMAS</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="govuk-grid-row ma-container-full govuk-!-margin-left-0">
            <div>
                <div class="dashboard-search-link-container">
                    <a href="{% url 'users:account_saved_searches' %}"
                       class="govuk-link--no-visited-state-dark">My saved searches</a>
                </div>
                <div class="dashboard-search-link-container">
                    <a href="{% url 'users:account_downloads' %}"
                       class="govuk-link--no-visited-state-dark">My downloads</a>
                </div>
                <div class="dashboard-search-link-container">
                    <a href="{% url 'barriers:search' %}?user=1&status=2"
                       class="govuk-link--no-visited-state-dark">My open barriers</a>
                </div>
            </div>
        </div>
    </div>
{% endblock masthead %}
{% block content %}
    <section title="Barrier insights">
        {% if barrier_task_list %}
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">{% include "barriers/partials/dashboard_tasks.html" %}</div>
            </div>
        {% endif %}
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                <div class="govuk-summary-card">
                    <div class="govuk-summary-card__title-wrapper">
                        <h3 class="govuk-summary-card__title">See data for barriers you're working on or monitoring</h3>
                    </div>
                    {% include "barriers/partials/summary_cards.html" %}
                </div>
            </div>
        </div>
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">{% include "barriers/partials/whats_new.html" %}</div>
        </div>
    </section>
{% endblock content %}
