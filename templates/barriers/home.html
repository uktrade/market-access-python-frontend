{% extends 'base.html' %}
{% load static %}
{% load render_bundle from webpack_loader %}
{% block page_title %}{{ block.super }} - Homepage{% endblock %}
{% block head %}
    {% render_bundle 'main' 'js' 'REACT' %}
    {% block body_script %}
        <script nonce="{{request.csp_nonce}}">

            document.addEventListener("DOMContentLoaded", function (event) {
                ma.pages.index();
                const month = new Date().toLocaleString('en-GB', { month: 'long' });
                const year = new Date().getFullYear();
                const newsletterLink = document.querySelector("#month-placeholder").parentNode;
                newsletterLink.href = `https://data-services-help.trade.gov.uk/market-access/newsletters/${month.toLowerCase()}/${year}`;
                newsletterLink.textContent = `DMAS newsletter for ${month} ${year}`;

                ReactApp.renderPieChart(
                    {
                        series: [300, 660, 50, 330],
                        options: {
                            chart: {
                                id: 'basic-pie',
                            },
                            title: {
                                text: 'Monthly Sales Data',
                                align: 'center'
                            },
                            dataLabels: {
                                enabled: false
                            },
                            labels: ['Top 100 Priority Barriers', 'Overseas Delivery', 'Non Profit', 'Watchlist'],
                            colors: ['#28a197', '#003078', '#d4351c', '#912b88'],
                        }
                    },"pie-chart");

                ReactApp.renderBarChart(
                    {
                        series: [
                            {
                                name: "Open Barriers",
                                data: [30]
                            },
                            {
                                name: "Resolved Barriers",
                                data: [40]
                            }
                        ],
                        options: {
                            chart: {
                                id: 'basic-bar',
                                toolbar: {
                                    show: true
                                }
                            },
                            xaxis: {
                                categories: ['Total Barriers'],
                            },
                            yaxis: {
                                categories: ['0', '20', '40', '60', '80', '100'],
                            },
                            colors: ['#912b88', '#003078'],
                            title: {
                                text: 'Total barrier value',
                                align: 'center'
                            },
                        }
                    }, "bar-chart");
                ReactApp.renderStackedBarChart(
                    {
                        series: [
                            {
                                name: 'Resolved Barriers',
                                data: [330]
                            },
                            {
                                name: 'Estimated Value',
                                data: [2300]
                            }
                        ],
                        options: {
                            chart: {
                                id: 'stacked-bar',
                            },
                            xaxis: {
                                categories: ['Aug'],
                            },
                            yaxis: {
                                title: {
                                    text: 'MnÂ£'
                                }
                            },
                            title: {
                                text: 'Monthly Sales Data',
                                align: 'center'
                            },
                            fill: {
                                opacity: 1
                            },
                            colors: ['#912b88', '#003078'],
                        }
                    },"stacked-bar-chart"
                )
            })
        </script>
    {% endblock %}
{% endblock %}

{% block main %}
    {% block before_content %}
        <div class="m-l-6">
            {{ block.super }}
        </div>
    {% endblock %}
    <main class="govuk-main-wrapper govuk-main-wrapper--dashboard" id="main-content" role="main">
        {% block content %}
            <div class="govuk-grid-row grey p-l-4 p-t-6">
                <div class="govuk-grid-column-full">
                    <h1 class="govuk-heading-xl">
                        <span class="govuk-caption-m">Market access barriers</span>
                        Dashboard
                    </h1>
                    <div class="govuk-form-group">
                        <form action="{% url 'barriers:search' %}" method="GET">
                            <input class="govuk-input govuk-!-width-two-thirds" id="event-name" name="search" type="text" placeholder="Search for barrier by name or with key terms.">
                            <button type="submit" class="govuk-button" data-module="govuk-button">
                                Search
                            </button>
                        </form>
                        <div>
                            <a href="{% url 'barriers:dashboard' %}?active=saved_searches" class="govuk-link govuk-link--no-visited-state-dark">My saved searches</a>
                            <a href="{% url 'barriers:dashboard' %}?active=barrier_downloads" class="govuk-link govuk-link--no-visited-state-dark">My downloads</a>
                            <a href="{% url 'barriers:search' %}?user=1" class="govuk-link govuk-link--no-visited-state-dark">My open barriers</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="govuk-grid-row p-l-4 p-r-6 p-t-6">
                <div class="govuk-grid-column-full">
                    {% include "barriers/partials/dashboard_tasks.html" %}
                </div>
            </div>
            <div class="govuk-grid-row p-l-4 p-r-6">
                <div class="govuk-grid-column-full">
                    <div class="govuk-summary-card">
                        <div class="govuk-summary-card__title-wrapper">
                            <h3 class="govuk-summary-card__title">See data for barriers you're working on or monitoring</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="govuk-grid-row p-l-4 p-r-6">
                <div class="govuk-grid-column-full">
                    {% include "barriers/partials/dashboard-charts.html" %}
                </div>
            </div>
            <div class="govuk-grid-row p-l-4 p-r-6">
                <div class="govuk-grid-column-full">
                    {% include "barriers/partials/whats_new.html" %}
                </div>
            </div>
        {% endblock %}
    </main>
{% endblock %}
