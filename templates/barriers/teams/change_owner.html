{% extends "barriers/edit/base.html" %}

{% load highlight %}

{% block page_title %}{{ block.super }} - Barrier team - Change owner{% endblock %}

{% block back_link %}
    <a href="{% url 'barriers:team' barrier.id %}" class="govuk-back-link ma-back-link">Back</a>
{% endblock %}

{% block page_content %}

    {% include 'partials/heading.html' with text='Change owner' %}

    {% form_error_banner form %}

    <div class="restrict-width team-member__change-owner">

        <h3 class="modal__content__title" id="modal-label">Current owner</h3>

        <dl class="details-list">
            <div class="details-list__group">
                <dt class="details-list__key">Name</dt>
                <dd class="details-list__value">{{ owner.user.full_name }}</dd>
            </div>
        </dl>

        <form action="" method="POST" role="search" class="change-owner-form">
            {% csrf_token %}

            <div id="{{ form.query.name }}" class="govuk-form-group">
                <label class="govuk-label govuk-!-font-size-19 govuk-!-font-weight-bold" for="user">
                    Find a user to add as the new owner
                </label>

                <span id="user-hint" class="govuk-hint">
                </span>

                {% form_field_error form "query" %}

                <div class="search-form__input-group">
                    <input
                        class="govuk-input search-form__input{% if form.query.error %} govuk-input--error{% endif %}"
                        id="user"
                        name="query"
                        type="text"
                        value="{% if form.query.value %}{{ form.query.value }}{% endif %}"
                        placeholder="Search for user"
                        {% if not form.query.value and not form.query.error %}autofocus{% endif %}
                        aria-describedby="user-hint"
                        >
                </div>
            </div>

            <button type="submit" class="search-form__button govuk-button">Search</button>
            <a href="{% url 'barriers:team' barrier.id %}" class="form-cancel">Cancel</a>

        </form>

        {% if error %}
            <p class="error-message">{{ error }}</p>
        {% endif %}

        {% if form.is_valid %}
            <h2 class="results-count">
                <span class="results-count__number">{{ results|length }}</span>
                users match <span class="highlight">{{ form.query.value }}</span>
            </h2>
        {% endif %}

        {% if results %}
            <ul class="search-card-list">
                {% for user in results %}
                    <form action="" method="POST" role="add" class="add-form">
                        {% csrf_token %}
                        <li class="search-card">
                            <input name="user_id" id="add_user_id" value="{{ user.user_id }}" hidden aria-hidden="true">
                            <input name="user_full_name" id="add_user_full_name" value="{{ user.first_name }} {{ user.last_name }}" hidden aria-hidden="true">
                            <button type="submit" name="action" value="add" class="search-card__button">
                                <h3 class="search-card__heading">Add {{ user.first_name|highlight:form.query.value }} {{ user.last_name|highlight:form.query.value }}</h3>
                            </button>
                        </li>
                    </form>
                {% endfor %}
            </ul>
        {% endif %}

    </div>

{% endblock %}
